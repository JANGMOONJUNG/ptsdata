<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Target DGG Rate</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@100;400&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #EEEEEE;
            color: #222831;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: #FFD369;
            color: #222831;
            padding: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
        }

        h1 {
            margin: 0px;
            font-size: 40px;
            font-family: "Nanum Pen Script", cursive;
            font-weight: 900;
        }

        nav {
            padding: 10px 0;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: space-around;
            gap: 32px;
        }

        nav ul li {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        nav ul li a {
            color: #393E46;
            text-decoration: none;
            font-size: 18px;
            font-family: 'Roboto', sans-serif;
            font-weight: 600;
            border-bottom: 2px solid #FFD369;
        }

        .active_menu {
            color: #6986ff;
        }

        nav ul li a:hover {
            color: #393E46;
            border-bottom: 2px solid #393E46;
        }

        .ticker {
            background-color: #222831;
            color: #FFD369;
            padding: 16px 0;
            text-align: center;
            font-weight: bold;
            overflow: hidden;
            position: relative;
        }

        .ticker div {
            display: inline-block;
            white-space: nowrap;
            animation: ticker 10s linear infinite;
            font-family: 'Roboto', sans-serif;
        }

        @keyframes ticker {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .content_wrap {
            width: 80%;
            max-width: 1200px;
            background-color: #ffffff;
            padding: 20px 40px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow-x: scroll;
        }

        .product_list {
            display: flex;
            gap: 20px;
            margin-bottom: 12px;
        }

        .product_item {
            width: 44px;
            height: 24px;
            font-size: 12px;
            color: #222831;
            border: 1px solid #222831;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            cursor: pointer;
        }

        .product_active {
            background-color: #222831;
            color: #ffffff;
        }

        #falseOptionList1 {
            display: flex;
            gap: 12px;
        }

        #falseOptionList2 {
            display: flex;
            gap: 12px;
        }

        .option_list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
        }

        .option_item {
            width: 32px;
            height: 18px;
            font-size: 10px;
            color: #6986ff;
            border: 1px solid #6986ff;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            cursor: pointer;
        }

        .option_active {
            background-color: #6986ff;
            color: #ffffff;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 4px;
            cursor: pointer;
        }

        th {
            background-color: #222831;
            color: white;
            font-size: 12px;
        }

        td {
            font-size: 10px;
        }

        .comment {
            margin-top: 20px;
        }

        .related-chart-container {
            display: flex;
            flex-direction: column;
            margin-top: 20px;
            width: 100%;
            align-items: center;
        }

        .related-chart {
            width: 80%;
            margin-top: 20px;
        }

        .tapBar {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tapBar div {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #222831;
            border-radius: 12px;
            margin: 0 10px;
        }

        .tap_active {
            background-color: #222831;
            color: #ffffff;
        }

        .table_wrap {
            margin-top: 20px;
        }

        .comment_box {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .chartContainer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-direction: column;
        }

        .chartWrapper {
            width: 45%;
        }

        .module_chartWrapper {
            width: 45%;
            margin-top: 20px;
        }

        .module_comment {
            margin-top: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>

<body>
    <header>
        <h1>개발PTS</h1>
        <nav>
            <ul>
                <li><a href="./index.html">HOME</a></li>
                <li><a href="./status.html">STATUS</a></li>
                <li><a href="./inspection.html">검출관리</a></li>
                <li><a href="./trend.html">TREND분석</a></li>
                <li><a href="./targetdgg.html" class="active_menu">TG DGG관리</a></li>
                <li><a href="#">관리 SPEC</a></li>
            </ul>
        </nav>
    </header>
    <div class="ticker">
        <div>금주 PTS 검출 - 6EN 24 건 / 6EL 18건 / W7D 13건</div>
    </div>
    <div class="content">
        <div class="content_wrap">
            <div class="tapBar">
                <div class="tap_active" onclick="changeTab(event, 'dggRate')">DGG Rate</div>
                <div onclick="changeTab(event, 'falseReason')">False 사유 입력</div>
            </div>
            <div id="dggRate" class="content_section">
                <div class="product_list" id="productList"></div>
                <h2 id="chartTitle">DC SPEC DGG RATE</h2>
                <div class="chartContainer">
                    <div class="chartWrapper">
                        <canvas id="barChart1" width="400" height="200"></canvas>
                    </div>
                    <div class="comment_box">
                        <div class="comment" id="comment1">CP 제품 DGG FALSE 항목 98개에 대한 사유 미입력 항목 53개가 있습니다.</div>
                    </div>
                </div>
                <div id="moduleChartsContainer" class="chartContainer">
                    <!-- Module charts will be generated here dynamically -->
                </div>
            </div>
            <div id="falseReason" class="content_section" style="display: none;">
                <h2>False 사유 입력</h2>
                <div class="product_list" id="falseProductList"></div>
                <div class="option_list">
                    <div id="falseOptionList1"></div>
                    <div id="falseOptionList2"></div>
                </div>
                <div class="table_wrap">
                    <table id="falseReasonTable">
                        <thead>
                            <tr>
                                <th colspan="5">제품 정보</th>
                                <th colspan="8">옵션 1</th>
                                <th colspan="8">옵션 2</th>
                                <th colspan="4">사유</th>
                            </tr>
                            <tr>
                                <th>GRADE</th>
                                <th>Module</th>
                                <th>STEP</th>
                                <th>STEP_DESC</th>
                                <th>DCOL_ITEM_CD</th>
                                <th>GRADE</th>
                                <th>Target</th>
                                <th>SPEC_UL</th>
                                <th>SPEC_LL</th>
                                <th>SPEC_ACT</th>
                                <th>YLD_UL</th>
                                <th>YLD_LL</th>
                                <th>YLD_ACT</th>
                                <th>GRADE</th>
                                <th>Target</th>
                                <th>SPEC_UL</th>
                                <th>SPEC_LL</th>
                                <th>SPEC_ACT</th>
                                <th>YLD_UL</th>
                                <th>YLD_LL</th>
                                <th>YLD_ACT</th>
                                <th>판정</th>
                                <th>사유</th>
                                <th>사유여부</th>
                                <th>IM최종판정</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 데이터가 여기 채워질 예정 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2024. 개발PTS All rights reserved.</p>
    </footer>
    <script>
        const data = {
            CP: {
                options: ['1CP', '2CP', '3CP', '4CP', '5CP'],
                steps: [
                    { step: 'PL(P)_E_C_C_HWAFER_%^_%_2' },
                    { step: 'MC_E_CWAFER_%^_%_9' },
                    { step: 'MC_E_CWAFER_%^_%_11' }
                ],
                dggRate: [93.30, 85.30, 80.20, 75.70, 70.30],
                comment: 'CP 제품 DGG FALSE 항목 98개에 대한 사유 미입력 항목 53개가 있습니다.',
                moduleData: {
                    '1CP': [97.60, 94.60, 96.50, 85.50, 98.00, 89.40],
                    '2CP': [96.60, 92.60, 95.50, 84.50, 97.00, 88.40],
                    '3CP': [95.60, 91.60, 94.50, 83.50, 96.00, 87.40],
                    '4CP': [94.60, 90.60, 93.50, 82.50, 95.00, 86.40],
                    '5CP': [93.60, 89.60, 92.50, 81.50, 94.00, 85.40]
                }
            },
            LC: {
                options: ['1LC', '2LC', '3LC', '4LC'],
                steps: [
                    { step: 'LC_E_LWAFER_%^_%_22' },
                    { step: 'LC_E_LWAFER_%^_%_23' }
                ],
                dggRate: [88.30, 75.30, 70.20, 65.70, 60.30],
                comment: 'LC 제품 DGG FALSE 항목 45개에 대한 사유 미입력 항목 23개가 있습니다.',
                moduleData: {
                    '1LC': [90.60, 88.60, 91.50, 82.20, 90.00, 85.40],
                    '2LC': [89.60, 87.60, 90.50, 81.20, 89.00, 84.40],
                    '3LC': [88.60, 86.60, 89.50, 80.20, 88.00, 83.40],
                    '4LC': [87.60, 85.60, 88.50, 79.20, 87.00, 82.40]
                }
            },
            SP: {
                options: ['1SP', '2SP', '3SP', '4SP'],
                steps: [
                    { step: 'SP_E_S_WAFER_%^_%_24' },
                    { step: 'SP_M_S_WAFER_%^_%_25' }
                ],
                dggRate: [78.30, 65.30, 60.20, 55.70, 50.30],
                comment: 'SP 제품 DGG FALSE 항목 34개에 대한 사유 미입력 항목 17개가 있습니다.',
                moduleData: {
                    '1SP': [88.60, 86.60, 89.50, 81.20, 87.30, 84.20],
                    '2SP': [87.60, 85.60, 88.50, 80.20, 86.30, 83.20],
                    '3SP': [86.60, 84.60, 87.50, 79.20, 85.30, 82.20],
                    '4SP': [85.60, 83.60, 86.50, 78.20, 84.30, 81.20]
                }
            }
        };

        let selectedProduct = 'CP';
        let selectedOption1 = '1CP';
        let selectedOption2 = '2CP';
        let chart1, moduleCharts = [];

        function changeProduct(event) {
            selectedProduct = event.target.innerText;
            document.querySelectorAll('.product_item').forEach(item => item.classList.remove('product_active'));
            event.target.classList.add('product_active');
            updateOptions();
            updateCharts();
            updateFalseReasonTable();
        }

        function changeOption1(event) {
            selectedOption1 = event.target.innerText;
            document.querySelectorAll('#falseOptionList1 .option_item').forEach(item => item.classList.remove('option_active'));
            event.target.classList.add('option_active');
            updateFalseReasonTable();
        }

        function changeOption2(event) {
            selectedOption2 = event.target.innerText;
            document.querySelectorAll('#falseOptionList2 .option_item').forEach(item => item.classList.remove('option_active'));
            event.target.classList.add('option_active');
            updateFalseReasonTable();
        }

        function updateOptions() {
            const optionList1 = document.getElementById('falseOptionList1');
            const optionList2 = document.getElementById('falseOptionList2');
            optionList1.innerHTML = '';
            optionList2.innerHTML = '';

            const options = data[selectedProduct].options;
            options.forEach(option => {
                const optionItem1 = document.createElement('div');
                optionItem1.className = 'option_item';
                optionItem1.innerText = option;
                optionItem1.onclick = changeOption1;
                if (option === selectedOption1) {
                    optionItem1.classList.add('option_active');
                }
                optionList1.appendChild(optionItem1);

                const optionItem2 = document.createElement('div');
                optionItem2.className = 'option_item';
                optionItem2.innerText = option;
                optionItem2.onclick = changeOption2;
                if (option === selectedOption2) {
                    optionItem2.classList.add('option_active');
                }
                optionList2.appendChild(optionItem2);
            });
        }

        function updateCharts() {
            const ctx1 = document.getElementById('barChart1').getContext('2d');
            const productData = data[selectedProduct];

            if (chart1) chart1.destroy();
            moduleCharts.forEach(chart => chart.destroy());
            moduleCharts = [];

            chart1 = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: productData.options,
                    datasets: [{
                        label: `${selectedProduct} 제품별 DGG Rate`,
                        data: productData.dggRate,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function (value) {
                                    return value + "%";
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });

            const moduleChartsContainer = document.getElementById('moduleChartsContainer');
            moduleChartsContainer.innerHTML = '';

            productData.options.forEach(option => {
                const moduleChartWrapper = document.createElement('div');
                moduleChartWrapper.className = 'module_chartWrapper';
                moduleChartWrapper.innerHTML = `
                    <canvas id="moduleChart_${option}" width="400" height="200"></canvas>
                    <div class="module_comment">${option} 모듈별 DGG Rate 입니다.</div>
                `;
                moduleChartsContainer.appendChild(moduleChartWrapper);

                const ctxModule = document.getElementById(`moduleChart_${option}`).getContext('2d');
                const moduleChart = new Chart(ctxModule, {
                    type: 'bar',
                    data: {
                        labels: ['IBG', 'SAC', 'GT', 'SN', 'MLM1', 'MLM2'],
                        datasets: [{
                            label: `${option} 모듈별 DGG Rate`,
                            data: productData.moduleData[option],
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function (value) {
                                        return value + "%";
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        }
                    }
                });

                moduleCharts.push(moduleChart);
            });

            document.getElementById('chartTitle').innerText = `${selectedProduct} 제품별 DGG Rate`;
            document.getElementById('comment1').innerText = productData.comment;
        }

        function updateFalseReasonTable() {
            const falseReasonTable = document.getElementById('falseReasonTable').getElementsByTagName('tbody')[0];
            falseReasonTable.innerHTML = '';

            const steps = data[selectedProduct].steps;

            steps.forEach(step => {
                const row = falseReasonTable.insertRow();
                const reasonCell = `<button onclick="inputReason(this)">입력</button>`;
                row.innerHTML = `
                    <td>${selectedProduct}</td>
                    <td>${selectedOption1}</td>
                    <td>${step.step}</td>
                    <td>STEP_DESC</td>
                    <td>DCOL_ITEM_CD</td>
                    <td>${selectedOption1}</td>
                    <td>849.1</td>
                    <td>10.3</td>
                    <td>10.3</td>
                    <td>SPEC_ACT</td>
                    <td>4.5</td>
                    <td>4.5</td>
                    <td>YLD_ACT</td>
                    <td>${selectedOption2}</td>
                    <td>849.1</td>
                    <td>10.3</td>
                    <td>10.3</td>
                    <td>SPEC_ACT</td>
                    <td>4.5</td>
                    <td>4.5</td>
                    <td>YLD_ACT</td>
                    <td>판정</td>
                    <td>${reasonCell}</td>
                    <td>사유여부</td>
                    <td>IM최종판정</td>
                `;
            });
        }

        function inputReason(button) {
            const reason = prompt("사유를 입력하세요:");
            if (reason) {
                button.outerHTML = reason;
            }
        }

        function changeTab(event, tab) {
            document.querySelectorAll('.tapBar > div').forEach(div => div.classList.remove('tap_active'));
            event.target.classList.add('tap_active');

            document.querySelectorAll('.content_section').forEach(section => section.style.display = 'none');
            document.getElementById(tab).style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const productList = document.getElementById('productList');
            const falseProductList = document.getElementById('falseProductList');
            for (const product in data) {
                const productItem = document.createElement('div');
                productItem.className = 'product_item';
                productItem.innerText = product;
                productItem.onclick = changeProduct;
                if (product === 'CP') {
                    productItem.classList.add('product_active');
                }
                productList.appendChild(productItem);

                const falseProductItem = document.createElement('div');
                falseProductItem.className = 'product_item';
                falseProductItem.innerText = product;
                falseProductItem.onclick = changeProduct;
                falseProductList.appendChild(falseProductItem);
            }

            document.querySelector(".tap_active").click();
            updateCharts();
            updateOptions();
        });
    </script>
</body>

</html>